<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì„ ë¬¼ë°•ìŠ¤ ë½‘ê¸°</title>

<style>
:root { --scale: 1; }

body {
    background: #ffffff;
    color: #0f172a;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 30px;
    transform: scale(var(--scale));
    transform-origin: top center;
}

/* ===== ë²ˆí˜¸ ê·¸ë¦¬ë“œ ===== */
.grid {
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    gap: 10px;
    max-width: 620px;
    margin: 30px auto;
}

.cell {
    background: #f1f5f9;
    padding: 16px 0;
    border-radius: 8px;
    font-size: 18px;
}

.cell.picked {
    background: #e2e8f0;
    color: #64748b;
}

/* ===== ì„ ë¬¼ë°•ìŠ¤ ===== */
.box-wrapper {
    width: 220px;
    margin: 40px auto;
}

#lid {
    transform-origin: center bottom;
}

.shake {
    animation: shake 0.6s;
}

@keyframes shake {
    0% { transform: rotate(0); }
    25% { transform: rotate(4deg); }
    50% { transform: rotate(-4deg); }
    75% { transform: rotate(3deg); }
    100% { transform: rotate(0); }
}

.open #lid {
    animation: openLid 0.6s forwards;
}

@keyframes openLid {
    to {
        transform: rotateX(70deg) translateY(-30px);
    }
}

/* ===== ë²„íŠ¼ ===== */
.buttons {
    margin-top: 20px;
}

button {
    padding: 16px 30px;
    font-size: 18px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    margin: 6px;
}

.draw-btn { background: #38bdf8; color: white; }
.reset-btn { background: #e5e7eb; }
.screen-btn { background: #22c55e; color: white; }

/* ===== ëª¨ë‹¬ ===== */
.modal-bg {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10;
}

.modal {
    background: white;
    padding: 50px 70px;
    border-radius: 26px;
    text-align: center;
    position: relative;
    animation: modalPop 0.4s ease;
}

@keyframes modalPop {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
}

.modal h2 {
    font-size: 34px;
}

.modal .num {
    font-size: 96px;
    font-weight: bold;
    color: #f43f5e;
    margin: 20px 0 30px;
    animation: glow 1.5s infinite alternate;
}

@keyframes glow {
    from { text-shadow: 0 0 10px #fda4af; }
    to { text-shadow: 0 0 30px #fb7185; }
}

/* ===== í­ì£½ ===== */
.firework {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #facc15;
    border-radius: 50%;
    animation: fire 1s forwards;
}

@keyframes fire {
    to {
        transform: translate(var(--x), var(--y)) scale(0);
        opacity: 0;
    }
}
</style>
</head>

<body>

<h1>ğŸ ì˜¥ì •êµíšŒ ì„ ë¬¼ ë½‘ê¸°</h1>

<div class="box-wrapper" id="boxWrap">
<svg width="220" height="220" viewBox="0 0 220 220">
    <ellipse cx="110" cy="195" rx="70" ry="12" fill="#000" opacity="0.08"/>
    <rect x="40" y="90" width="140" height="90" rx="14" fill="#fb7185"/>
    <rect x="100" y="90" width="20" height="90" fill="#fbbf24"/>
    <rect x="40" y="125" width="140" height="20" fill="#fbbf24"/>
    <g id="lid">
        <rect x="35" y="60" width="150" height="40" rx="14" fill="#fda4af"/>
        <rect x="100" y="60" width="20" height="40" fill="#facc15"/>
    </g>
</svg>
</div>

<div class="buttons">
    <button class="draw-btn" onclick="draw()">ë½‘ê¸°</button>
    <button class="reset-btn" onclick="resetAll()">ì´ˆê¸°í™”</button>
    <button class="screen-btn" onclick="toggleScreen()">ëŒ€í˜• ìŠ¤í¬ë¦° ëª¨ë“œ</button>
</div>

<div class="grid" id="grid"></div>

<div class="modal-bg" id="modalBg">
    <div class="modal" id="modal">
        <h2>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
        <div class="num" id="modalNum"></div>
        <button onclick="closeModal()">í™•ì¸</button>
    </div>
</div>

<script>
/* ===== Web Audio (íŒŒì¼ ì—†ëŠ” íš¨ê³¼ìŒ) ===== */
let audioCtx;

function playShakeSound() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "square";
    osc.frequency.value = 280;

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);

    osc.start();
    osc.stop(audioCtx.currentTime + 0.2);
}

/* ğŸ¶ ë”°ë¼ë€~ ë©œë¡œë”” */
function playTtararan() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    const notes = [523, 659, 784]; // ë„-ë¯¸-ì†”
    let time = audioCtx.currentTime;

    notes.forEach(freq => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = "triangle";
        osc.frequency.value = freq;

        osc.connect(gain);
        gain.connect(audioCtx.destination);

        gain.gain.setValueAtTime(0.35, time);
        gain.gain.exponentialRampToValueAtTime(0.001, time + 0.18);

        osc.start(time);
        osc.stop(time + 0.18);

        time += 0.15;
    });
}

/* ===== ë¡œì§ ===== */
const TOTAL = 45;
let picked = new Set();
let available = [];
let screenMode = false;

const boxWrap = document.getElementById("boxWrap");
const grid = document.getElementById("grid");
const modalBg = document.getElementById("modalBg");
const modalNum = document.getElementById("modalNum");
const modal = document.getElementById("modal");

function save() {
    localStorage.setItem("picked", JSON.stringify([...picked]));
}

function load() {
    picked = new Set(JSON.parse(localStorage.getItem("picked") || "[]"));
    available = Array.from({ length: TOTAL }, (_, i) => i + 1)
        .filter(n => !picked.has(n));
}

function init() {
    load();
    renderGrid();
}
init();

function renderGrid() {
    grid.innerHTML = "";
    for (let i = 1; i <= TOTAL; i++) {
        const d = document.createElement("div");
        d.className = "cell";
        if (picked.has(i)) {
            d.classList.add("picked");
            d.innerText = "ğŸ";
        } else {
            d.innerText = i;
        }
        grid.appendChild(d);
    }
}

function draw() {
    if (available.length === 0) return;

    playShakeSound();

    boxWrap.classList.remove("open");
    boxWrap.classList.add("shake");

    setTimeout(() => {
        boxWrap.classList.remove("shake");
        boxWrap.classList.add("open");
    }, 600);

    setTimeout(() => {
        const idx = Math.floor(Math.random() * available.length);
        const num = available.splice(idx, 1)[0];
        picked.add(num);
        save();

        playTtararan(); // ğŸ¶ ë”°ë¼ë€~

        modalNum.innerText = num;
        modalBg.style.display = "flex";
        firework();
        renderGrid();
    }, 1100);
}

function firework() {
    for (let i = 0; i < 24; i++) {
        const f = document.createElement("div");
        f.className = "firework";
        f.style.setProperty("--x", `${Math.random()*240-120}px`);
        f.style.setProperty("--y", `${Math.random()*240-120}px`);
        modal.appendChild(f);
        setTimeout(() => f.remove(), 1000);
    }
}

function closeModal() {
    modalBg.style.display = "none";
}

function resetAll() {
    localStorage.removeItem("picked");
    picked.clear();
    available = Array.from({ length: TOTAL }, (_, i) => i + 1);
    renderGrid();
    modalBg.style.display = "none";
}

function toggleScreen() {
    screenMode = !screenMode;
    document.documentElement.style.setProperty("--scale", screenMode ? 1.4 : 1);
}
</script>

</body>
</html>
